name: Create Release

on:
  workflow_dispatch:
    inputs:
      release_notes:
        description: '发布说明'
        required: false
        default: '常规更新'

# 添加权限配置
permissions:
  contents: write

jobs:
  create-release:
    runs-on: ubuntu-latest
    steps:
      - name: 检出代码
        uses: actions/checkout@v4

      - name: 读取版本号
        id: get_version
        run: |
          echo "查找文件"
          ls -la
          echo "读取版本号"
          VERSION=$(grep -o 'content="V[0-9]\+\.[0-9]\+"' "./木然の摸鱼管理器.html" | grep -o 'V[0-9]\+\.[0-9]\+')
          if [ -z "$VERSION" ]; then
            echo "错误：无法从文件中读取版本号"
            exit 1
          fi
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "读取到版本号: $VERSION"

      - name: 创建Release
        id: create_release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ steps.get_version.outputs.version }}
          name: 木然の摸鱼管理器 ${{ steps.get_version.outputs.version }}
          body: |
            # 木然の摸鱼管理器 ${{ steps.get_version.outputs.version }}
            
            版本号: ${{ steps.get_version.outputs.version }}
            ${{ github.event.inputs.release_notes }}
            
            ---  
          files: ./木然の摸鱼管理器.html
          asset_name: 木然の摸鱼管理器.html
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: 发布结果
        run: |
          echo "✅ Release创建成功: ${{ steps.get_version.outputs.version }}"
          echo "🔗 Release链接: ${{ github.server_url }}/${{ github.repository }}/releases/tag/${{ steps.get_version.outputs.version }}"